<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style/dashboardstyle.css">
    <title>Dashboard</title>
</head>

<body>
    <div class="container">
        <div class="navigation">
            <ul>
                <li>
                    <a href="#">
                        <span class="icon">
                            <ion-icon name="rocket"></ion-icon>
                        </span>
                        <span class="title">Affiliate Place</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="overviewtoggle">
                        <span class="icon">
                            <ion-icon name="home-outline"></ion-icon>
                        </span>
                        <span class="title">Overview/Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="company">
                        <span class="icon">
                            <ion-icon name="bag-handle-outline"></ion-icon>
                        </span>
                        <span class="title">Products/Company</span>
                    </a>
                </li>
                <li>
                    <!--eventuell einstellung für passwort änderung ?-->
                    <a href="/logout">
                        <span class="icon">
                            <ion-icon name="log-out-outline"></ion-icon>
                        </span>
                        <span class="title">Sign Out</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- main -->
        <div class="main">
            <div class="topbar">
                <div class="toggle">
                    <ion-icon name="grid-outline"></ion-icon>
                </div>
                <!-- searchbar -->
                <div class="search">
                    <label>
                        <input type="text" placeholder="Search">
                        <ion-icon name="search-outline"></ion-icon>
                    </label>
                </div>
                <!-- userbild (todo)-->
                <div class="user">
                    <img src="/img/user.png">
                </div>
            </div>

            <!-- Firmen Cards -->
            <div class="companyCards"></div>

            <!-- card übersicht -->
            <div id="overview">
                <div class="cardBox">
                    <div class="card">
                        <div>
                            <div class="numbers">1,550€</div>
                            <div class="cardName">Total Income</div>
                        </div>
                        <div class="iconBox">
                            <ion-icon name="cash-outline"></ion-icon>
                        </div>
                    </div>


                    <div class="card">
                        <div>
                            <div  id="totalClicks" class="numbers">0</div>
                            <div  class="cardName">Total Clicks</div>
                        </div>
                        <div class="iconBox">
                            <ion-icon name="eye-outline"></ion-icon>
                        </div>
                    </div>


                    <div class="card">
                        <div>
                            <div class="numbers">84</div>
                            <div class="cardName">Products</div>
                        </div>
                        <div class="iconBox">
                            <ion-icon name="cart-outline"></ion-icon>
                        </div>
                    </div>


                    <div class="card">
                        <div>
                            <div class="numbers">1,85€</div>
                            <div class="cardName">Ø Income per Click</div>
                        </div>
                        <div class="iconBox">
                            <ion-icon name="trending-up-outline"></ion-icon>
                        </div>
                    </div>
                </div>

                <!-- payment detail liste-->
                <div class="details">
                    <div class="recentPayment">
                        <div class="cardHeader">
                            <h2>Payment Status</h2>
                            <a href="#" class="btn">View All</a>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <td> Company</td>
                                    <td> Payment</td>
                                    <td> Date</td>
                                    <td> Status</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Company1</td>
                                    <td>120€</td>
                                    <td>01.01.2022</td>
                                    <td><span class="status paid">Paid</span></td>
                                </tr>
                                <tr>
                                    <td>Company2</td>
                                    <td>12€</td>
                                    <td>01.01.2022</td>
                                    <td><span class="status paid">Paid</span></td>
                                </tr>
                                <tr>
                                    <td>Company3</td>
                                    <td>8€</td>
                                    <td>01.01.2022</td>
                                    <td><span class="status in progress">in Progress</span></td>
                                </tr>
                                <tr>
                                    <td>Company4</td>
                                    <td>320€</td>
                                    <td>01.01.2022</td>
                                    <td><span class="status paid">Paid</span></td>
                                </tr>
                                <tr>
                                    <td>Company5</td>
                                    <td>180€</td>
                                    <td>01.01.2022</td>
                                    <td><span class="status pending">Pending</span></td>
                                </tr>
                                <tr>
                                    <td>Company6</td>
                                    <td>52€</td>
                                    <td>01.01.2022</td>
                                    <td><span class="status in progress">in Progress</span></td>
                                </tr>
                                <tr>
                                    <td>Company7</td>
                                    <td>36€</td>
                                    <td>01.01.2022</td>
                                    <td><span class="status paid">Paid</span></td>
                                </tr>
                                <tr>
                                    <td>Company8</td>
                                    <td>91€</td>
                                    <td>01.01.2022</td>
                                    <td><span class="status paid">Paid</span></td>
                                </tr>
                                <tr>
                                    <td>Company9</td>
                                    <td>487€</td>
                                    <td>01.01.2022</td>
                                    <td><span class="status pending">Pending</span></td>
                                </tr>
                                <tr>
                                    <td>Company10</td>
                                    <td>3€</td>
                                    <td>01.01.2022</td>
                                    <td><span class="status paid">Paid</span></td>
                                </tr>
                                <tr>
                                    <td>Company11</td>
                                    <td>111€</td>
                                    <td>01.01.2022</td>
                                    <td><span class="status in progress">in Progress</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.0.0-alpha.1/axios.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

    <script >
        // Menutoggle
        let toggle = document.querySelector('.toggle');
        let navigation = document.querySelector('.navigation');
        let main = document.querySelector('.main');

        toggle.onclick = function () {
            navigation.classList.toggle('active');
            main.classList.toggle('active');
        }



        // add hovered class in selected list item
        let list = document.querySelectorAll('.navigation li');

        function activeLink() {
            list.forEach((item) =>
                item.classList.remove('hovered'));
            this.classList.add('hovered');
        }
        list.forEach((item) =>
            item.addEventListener('mouseover', activeLink));

        document.querySelector('#company').onclick = function () {

            let company = document.querySelector('.companyCards').style.display = 'grid';

            document.querySelector('#overview').setAttribute('hidden', 'true');

        }
        document.querySelector('#overviewtoggle').onclick = function () {

            document.querySelector('.companyCards').style.display = 'none';

            document.querySelector('#overview').removeAttribute('hidden');
        }

        async function generateLink(companyId) {
            try {
                await axios.post('/generate-link', {
                    companyId
                }, {
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    withCredentials: true
                })
            } catch (error) {
                console.log(error)
            }
        }
        const companyCardsElement = document.getElementsByClassName('companyCards')[0]
        async function fetchCompanies() {
            try {
                const companies = await axios.get('/companies', null, {
                    headers: {
                        accept: 'application/json'
                    }
                })
                return companies.data
            } catch (error) {
                return []
            }
        }
        async function renderCompanies() {
            const companyData = await fetchCompanies()
            console.log(companyData)



            let companyCardsTemplate = ''
            companyData.forEach((companyInfo) => {
                companyCardsTemplate += `
        <button onclick="generateLink('${companyInfo._id}')" class="companyLinks">
                    <div class="card">
                        <div>
                            <div class="numbers">1,550€</div>
                            <div class="cardName">${companyInfo.name}</div>
                        </div>
                        <div class="iconBox">
                            <img class="logo" src="${companyInfo.logo}">
                        </div>
                        <div class="cardButton">
                            <input type="button" value="Generate Link">
                        </div>
                    </div>
                </button>
                `
            })
            companyCardsElement.innerHTML = companyCardsTemplate
        }

        renderCompanies()

         async function fetchClicks() {
            try {
              const result = await axios.get('/count-click', null, {
                    headers: {
                        accept: 'application/json'
                    },
                    withCredentials: true
                })
                document.getElementById('totalClicks').textContent = result.data.count
            
            } catch (error) {
                console.log(error)
            }
        }
        fetchClicks()
    </script>
</body>

</html>